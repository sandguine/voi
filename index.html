<!DOCTYPE html>
<html>
  <head>
    <title>VoI Experiment</title>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-auth.js"></script>

    <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyDTbXzArNLeU7XDAFz6TDPY4r57PbPVGy8",
        authDomain: "voi-js.firebaseapp.com",
        databaseURL: "https://voi-js.firebaseio.com",
        projectId: "voi-js",
        storageBucket: "voi-js.appspot.com",
        messagingSenderId: "1054701054881",
        appId: "1:1054701054881:web:178963a6d2a5b0546a39e0",
        measurementId: "G-2VZHX9EMPT"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();
    </script>

    <!-- scripts for the main experiment  -->
    <script src="js/database.js"></script>
    <script src="js/jspsych.js"></script>
    <script src="js/timelineVariables.js"></script>
    <script src="js/var.js"></script>
    <script src="js/jsPsych/jspsych-call-function.js"></script>
    <script src="js/jsPsych/jspsych-canvas-keyboard-response.js"></script>
    <script src="js/jsPsych/jspsych-fullscreen.js"></script>
    <script src="js/jsPsych/jspsych-instructions.js"></script>
    <script src="js/jsPsych/jspsych-html-keyboard-response.js"></script>
    <script src="js/jsPsych/jspsych-survey-multi-choice.js"></script>
    <script src="js/jsPsych/jspsych-survey-text.js"></script>

    <link href="css/jspsych.css" rel="stylesheet" type="text/css"></link>
    <link href="css/custom.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body>
  </body>
  <script>

    // run the whole experiment

    // logistics
    timeline.push(fullscreen, welcome, loopID, instructions);
    //timeline.push(loopID);

    // actual experiment
    timeline.push(procedure);

    // timeline.push(outcomeProcedure);

    /* start the experiment */
    jsPsych.init({
      timeline: timeline,
      on_finish: function() {

        function saveDB(data){
          var dataSaved = db.collection("habit-short").doc('version1').collection('participants').doc(uid).set(data);
        }

        jsPsych.data.addProperties(tvTest);
        // jsPsych.data.displayData();

        var alldata = jsPsych.data.get().values();
        var participantID = alldata[0].participantID;
        var session = alldata[0].session;

        saveDB(alldata);
        
        // var jsonString = jsPsych.data.get().dataAsJSON();
        // jsPsych.data.get().localSave(alldata, '/data/'+toString(participantID)+'.json'+'.json');
        // jsPsych.data.get().localSave('json', name);

      }
    });


  </script>
</html>
