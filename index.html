<!DOCTYPE html>
<html>
  <head>
    <title>VoI Experiment</title>

    <!-- core firebase js sdk -->
    <script src="https://www.gstatic.com/firebasejs/6.4.0/firebase-app.js"></script>

    <!-- sdk for other firebase products -->
    <script src="https://www.gstatic.com/firebasejs/6.4.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.4.0/firebase-auth.js"></script>

    <script>
      var firebaseConfig = {
        apiKey: "dsfjdshu4wru3rwefufguds",
        authDomain: "project.firebaseapp.com",
        databaseURL: "https://project.firebaseio.com",
        projectId: "project",
        storageBucket: "project.appspot.com",
        messagingSenderId: "83438438237409123",
        appId: "4:43344:web:256g4rfgdt3r23e"
      };
      // initialize firebase
      firebase.initializeApp(firebaseConfig);
    </script>

    <!-- scripts for the main experiment  -->
    <script src="js/database.js"></script>
    <script src="js/jspsych.js"></script>
    <script src="js/timelineVariables.js"></script>
    <script src="js/var.js"></script>
    <script src="js/jsPsych/jspsych-call-function.js"></script>
    <script src="js/jsPsych/jspsych-canvas-keyboard-response.js"></script>
    <script src="js/jsPsych/jspsych-fullscreen.js"></script>
    <script src="js/jsPsych/jspsych-instructions.js"></script>
    <script src="js/jsPsych/jspsych-html-keyboard-response.js"></script>
    <script src="js/jsPsych/jspsych-survey-multi-choice.js"></script>
    <script src="js/jsPsych/jspsych-survey-text.js"></script>

    <link href="css/jspsych.css" rel="stylesheet" type="text/css"></link>
    <link href="css/custom.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body>
  </body>
  <script>

    // run the whole experiment

    // logistics
    timeline.push(fullscreen, welcome, loopID, instructions);
    //timeline.push(loopID);

    // actual experiment
    timeline.push(procedure);

    // timeline.push(outcomeProcedure);

    /* start the experiment */
    jsPsych.init({
      timeline: timeline,
      on_finish: function() {

        // function saveData() {
        //   var xhr = new XMLHttpRequest();
        //   xhr.open('POST', 'write_data.php'); // change 'write_data.php' to point to php script.
        //   xhr.setRequestHeader('Content-Type', 'application/json');
        //   xhr.onload = function() {
        //     if(xhr.status == 200){
        //       var response = JSON.parse(xhr.responseText);
        //       console.log(response.success);
        //     }
        //   };
        //   xhr.send(jsPsych.data.get().json());
        // }

        jsPsych.data.addProperties(tvTest);
        jsPsych.data.displayData();

        var alldata = jsPsych.data.get().values();
        var participantID = alldata[0].participantID;
        var session = alldata[0].session;
        var name = '/data/'+toString(participantID)+toString(session)+'.json';
        // saveData();

        // var jsonString = jsPsych.data.dataAsJSON();
        // jsPsych.data.get().localSave(alldata, '/data/'+toString(participantID)+'.json'+'.json');
        // jsPsych.data.get().localSave('json', name);

      }
    });


  </script>
</html>
